---
import BaseLayout from "@layouts/BaseLayout.astro";
import { defaultLocale, locales } from "@lib/i18n";
import { arky } from "@lib/index";
import Service from "@lib/Reservation/Service/index.svelte";
import appConfig from "../../../appConfig";

export async function getStaticPaths() {
	const res = await fetch(`${appConfig.apiUrl}/v1/businesses/${appConfig.businessId}/services?limit=100`);

	if (!res.ok) {
		return [];
	}

	const { items } = await res.json();

	return items.flatMap((service) =>
		locales.map((locale) => {
			const slug = service.seo?.slug?.[locale] || service.seo?.slug?.en;
			if (!slug) return null;

			return {
				params: {
					slug: slug,
					locale: locale === defaultLocale ? undefined : locale,
				},
				props: { locale },
			};
		}).filter(Boolean),
	);
}

const { slug } = Astro.params;

const service = await arky.reservation.getService({ id: slug });
---

<BaseLayout>
	<Service client:load service={service} />
</BaseLayout>
